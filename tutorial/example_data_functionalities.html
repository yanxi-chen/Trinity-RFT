

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data processing functionalities &mdash; Trinity-RFT 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Trinity-RFT Configuration" href="trinity_configs.html" />
    <link rel="prev" title="Example: Run DPO on Human-Like-DPO-Dataset" href="example_dpo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Trinity-RFT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_basic.html">A quick example with GSM8k</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_reasoning_advanced.html">Example: off-policy RFT mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_multi_turn.html">Example: Multi-Turn RFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dpo.html">Example: Run DPO on Human-Like-DPO-Dataset</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data processing functionalities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-reasoning-task">Example: reasoning task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-preparation">Data Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-data-module">Configure the Data Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exploring-training">Exploring &amp; Training</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example-human-in-the-loop">Example: human in the loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Data Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Configure the Data Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-running">Start Running</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="trinity_configs.html">Trinity-RFT Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="trinity_programming_guide.html">Trinity-RFT Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.buffer.html">trinity.buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.explorer.html">trinity.explorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.trainer.html">trinity.trainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.manager.html">trinity.manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.common.html">trinity.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/trinity.utils.html">trinity.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Trinity-RFT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Data processing functionalities</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/example_data_functionalities.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-processing-functionalities">
<h1>Data processing functionalities<a class="headerlink" href="#data-processing-functionalities" title="Link to this heading"></a></h1>
<section id="example-reasoning-task">
<h2>Example: reasoning task<a class="headerlink" href="#example-reasoning-task" title="Link to this heading"></a></h2>
<p>In this example, you will learn how to apply the data module of Trinity-RFT to prepare the dataset before exploring and training. This example takes GSM-8K dataset as the example dataset to figure out:</p>
<ol class="arabic simple">
<li><p>how to prepare the data module</p></li>
<li><p>how to configure the data module</p></li>
<li><p>what the data module can do</p></li>
</ol>
<p>Before getting started, you need to prepare the main environment of Trinity-RFT according to the <a class="reference internal" href="../main.html"><span class="std std-doc">installation section of the README file</span></a>, and you need to install <a class="reference external" href="https://www.postgresql.org/docs/current/tutorial-install.html">postgresql</a> as well.</p>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Link to this heading"></a></h3>
<section id="prepare-the-data-module">
<h4>Prepare the Data Module<a class="headerlink" href="#prepare-the-data-module" title="Link to this heading"></a></h4>
<p>As the overall framework of Trinity-RFT shows, the data module is one of the high-level functions. Trinity-RFT encapsulates the data module as an independent service to avoid dependency conflict issues. Thus you need to prepare a split environment for this module and start the server.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare split environments, including the one of data module</span>
python<span class="w"> </span>scripts/install.py

<span class="c1"># start all split servers</span>
python<span class="w"> </span>scripts/start_servers.py
</pre></div>
</div>
</section>
</section>
<section id="configure-the-data-module">
<h3>Configure the Data Module<a class="headerlink" href="#configure-the-data-module" title="Link to this heading"></a></h3>
<p>Trinity-RFT uses a unified config file to manage all config items. For the data module, you need to focus on the <code class="docutils literal notranslate"><span class="pre">data</span></code> section in the config file.</p>
<p>In this example, assume that you need to rank all math questions and corresponding answers by their difficulties. So you can set these config items like the following example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># basic info</span>
<span class="w">  </span><span class="nt">dataset_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/gsm8k&#39;</span>
<span class="w">  </span><span class="nt">dataset_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;train&#39;</span><span class="w">  </span><span class="c1"># only need the train split</span>
<span class="w">  </span><span class="nt">format_config</span><span class="p">:</span><span class="w">  </span><span class="c1"># set the field mappings</span>
<span class="w">    </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">    </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">  </span><span class="c1"># database related. The result dataset will be stored in the database.</span>
<span class="w">  </span><span class="nt">db_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;postgresql://{user_name}@localhost:5432/{db_name}&#39;</span>
<span class="w">  </span><span class="c1"># downstream loading related</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">96</span>
<span class="w">  </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>
</pre></div>
</div>
<p>Here you can set the basic information for the GSM-8K dataset, database information that is used to store the result dataset, and some other items about downstream dataset loading for exploring and training:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dataset_path</span></code>: the path to the raw dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataset_config</span></code>: extra config arguments for loading the raw dataset. Mainly for the <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> method in HuggingFace <code class="docutils literal notranslate"><span class="pre">datasets</span></code> library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format_config</span></code>: some dataset format config items, which are used to map original data field names to unified ones.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">db_url</span></code>: the URL of the postgresql database to store the result dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_epochs</span></code>: the total number of epochs to train on this dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: the training batch size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_workflow_type</span></code>: the default exploring workflow type. Please refer to <a class="reference internal" href="trinity_programming_guide.html"><span class="std std-doc">programming guide</span></a> for more details.</p></li>
</ul>
<p>In addition, there are several config items related to the data active iterator, which is used to prepare a better dataset. The core part of the data active iterator, Data-Juicer, provides tens of operators to help clean or calculate key information for each sample in the dataset. You can configure this part depending on how familiar you are with Data-Juicer.</p>
<section id="not-familiar-with-data-juicer">
<h4>Not familiar with Data-Juicer<a class="headerlink" href="#not-familiar-with-data-juicer" title="Link to this heading"></a></h4>
<p>If you are not familiar with Data-Juicer, the data module provides a natural-language-based method to config the data processing recipe. What you need to do is only describe the demands of how you want to prepare for the raw dataset, and an agent will be invoked to arrange the data processing recipe for you. Here is an example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># basic info</span>
<span class="w">  </span><span class="nt">dataset_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/gsm8k&#39;</span>
<span class="w">  </span><span class="nt">dataset_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;train&#39;</span><span class="w">  </span><span class="c1"># only need the train split</span>
<span class="w">  </span><span class="nt">format_config</span><span class="p">:</span><span class="w">  </span><span class="c1"># set the field mappings</span>
<span class="w">    </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">    </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">  </span><span class="c1"># database related. The result dataset will be stored in the database.</span>
<span class="w">  </span><span class="nt">db_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;postgresql://{user_name}@localhost:5432/{db_name}&#39;</span>
<span class="w">  </span><span class="c1"># downstream loading related</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">96</span>
<span class="w">  </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>

<span class="w">  </span><span class="c1">#### new part about data active iterator</span>
<span class="w">  </span><span class="nt">dj_process_desc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Please</span><span class="nv"> </span><span class="s">compute</span><span class="nv"> </span><span class="s">difficulty</span><span class="nv"> </span><span class="s">scores</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">these</span><span class="nv"> </span><span class="s">math</span><span class="nv"> </span><span class="s">questions.&#39;</span>
<span class="w">  </span><span class="nt">agent_model_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;qwen-max&#39;</span>
<span class="w">  </span><span class="nt">agent_model_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">config_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;my-qwen-instruction&#39;</span>
<span class="w">    </span><span class="nt">model_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;dashscope_chat&#39;</span>
<span class="w">    </span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;qwen2.5-72b-instruct&#39;</span>
<span class="w">  </span><span class="nt">clean_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;iterative&#39;</span>
</pre></div>
</div>
<p>You can write your demand description in config item <code class="docutils literal notranslate"><span class="pre">dj_process_desc</span></code>, and set the model name and configs used for the agent in config items <code class="docutils literal notranslate"><span class="pre">agent_model_name</span></code> and <code class="docutils literal notranslate"><span class="pre">agent_model_config</span></code>. Here we use Qwen2.5-72b-Instruct as our recipe managing agent. And you can set the <code class="docutils literal notranslate"><span class="pre">clean_strategy</span></code> to ‘iterative’ to get a better dataset.</p>
</section>
<section id="familiar-with-data-juicer">
<h4>Familiar with Data-Juicer<a class="headerlink" href="#familiar-with-data-juicer" title="Link to this heading"></a></h4>
<p>If you are familiar with Data-Juicer, you will realize that Data-Juicer provides an operator that can calculate difficulty scores using existing LLMs. In this case, you can prepare your own Data-Juicer data processing recipe and equip this operator. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a Data-Juicer data processing recipe</span>
<span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;gsm-8k-difficulty&#39;</span>

<span class="nt">export_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/the/result/processed-dataset.jsonl&#39;</span>

<span class="nt">process</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">llm_difficulty_score_filter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">api_or_hf_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;qwen2.5-72b-instruct&quot;</span><span class="w">  </span><span class="c1"># use &quot;qwen2.5-72b-instruct&quot; to calculate the difficulty scores.</span>
<span class="w">      </span><span class="nt">input_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;question&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;answer&quot;</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># set input_keys and field_names to the existing key names in gsm-8k. Here calculating the difficulty scores according to both questions and answers.</span>
<span class="w">      </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;question&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;answer&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>After preparing the Data-Juicer data processing recipe, you can set the <code class="docutils literal notranslate"><span class="pre">dj_config_path</span></code> item in the Trinity-RFT config file to the path to this recipe. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># basic info</span>
<span class="w">  </span><span class="nt">dataset_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/gsm8k&#39;</span>
<span class="w">  </span><span class="nt">dataset_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;train&#39;</span><span class="w">  </span><span class="c1"># only need the train split</span>
<span class="w">  </span><span class="nt">format_config</span><span class="p">:</span><span class="w">  </span><span class="c1"># set the field mappings</span>
<span class="w">    </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;question&#39;</span>
<span class="w">    </span><span class="nt">response_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;answer&#39;</span>
<span class="w">  </span><span class="c1"># database related. The result dataset will be stored in the database.</span>
<span class="w">  </span><span class="nt">db_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;postgresql://{user_name}@localhost:5432/{db_name}&#39;</span>
<span class="w">  </span><span class="c1"># downstream loading related</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">96</span>
<span class="w">  </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>

<span class="w">  </span><span class="c1">#### new part about data active iterator</span>
<span class="w">  </span><span class="nt">dj_config_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/path/to/the/Data-Juicer/data/processing/recipe/above.yaml&#39;</span>
<span class="w">  </span><span class="nt">clean_strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;iterative&#39;</span>
</pre></div>
</div>
<p>And you can set the <code class="docutils literal notranslate"><span class="pre">clean_strategy</span></code> to ‘iterative’ to get a better dataset.</p>
<p>All config items in the <code class="docutils literal notranslate"><span class="pre">data</span></code> section can be found <a class="reference internal" href="trinity_configs.html"><span class="std std-doc">here</span></a>. A prepared config file for this example of GSM-8K can be found in <a class="reference external" href="https://github.com/modelscope/Trinity-RFT/tree/main/examples/grpo_gsm8k/gsm8k.yaml">the config file of gsm8k</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only when one of <code class="docutils literal notranslate"><span class="pre">dj_process_desc</span></code> and <code class="docutils literal notranslate"><span class="pre">dj_config_path</span></code> is provided, the data module and the data active iterator will be activated. Otherwise, this part will be skipped and it will enter into the exploring stage directly.</p>
</div>
</section>
</section>
<section id="exploring-training">
<h3>Exploring &amp; Training<a class="headerlink" href="#exploring-training" title="Link to this heading"></a></h3>
<p>After preparing the config files of Trinity-RFT, you can start your ray cluster and run the RFT process including the data active iterator part with the following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># start the ray cluster</span>
<span class="c1"># on master node</span>
ray<span class="w"> </span>start<span class="w"> </span>--head
<span class="c1"># on worker nodes</span>
ray<span class="w"> </span>start<span class="w"> </span>--address<span class="o">=</span>&lt;master_address&gt;

<span class="c1"># run RFT</span>
trinity<span class="w"> </span>run<span class="w"> </span>--config<span class="w"> </span>&lt;Trinity-RFT_config_path&gt;
</pre></div>
</div>
<p>If you follow the steps above, Trinity-RFT will send a request to the data module server, the data active iterator will be activated and compute difficulty scores for each sample in the raw dataset. After that, the data module server stores the result dataset into the database, when exploring begins, it will load the prepared dataset and continue the downstream steps.</p>
</section>
</section>
<section id="example-human-in-the-loop">
<h2>Example: human in the loop<a class="headerlink" href="#example-human-in-the-loop" title="Link to this heading"></a></h2>
<p>Sometimes, you might need to involve human feedbacks for some raw data. In this example, you will learn how to annotate raw data to get a better dataset before training. This example takes an example Q&amp;A dataset and tries to select the chosen and rejected ones for DPO method.</p>
<p>Before getting started, you need to prepare the main environment of Trinity-RFT according to the installation section of the README file, install postgresql, and <a class="reference external" href="https://github.com/modelscope/data-juicer/tree/main/tools/humanops">start a label-studio server</a> from Data-Juicer from source.</p>
<section id="id1">
<h3>Data Preparation<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<section id="id2">
<h4>Prepare the Data Module<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>As the overall framework of Trinity-RFT shows, the data module is one of the high-level functions. Trinity-RFT encapsulates the data module as an independent service to avoid dependency conflict issues. Thus you need to prepare a split environment for this module and start the server.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare split environments, including the one of data module</span>
python<span class="w"> </span>scripts/install.py

<span class="c1"># start all split servers</span>
python<span class="w"> </span>scripts/start_servers.py
</pre></div>
</div>
</section>
</section>
<section id="id3">
<h3>Configure the Data Module<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Trinity-RFT uses a unified config file to manage all config items. For the data module, you need to focus on the <code class="docutils literal notranslate"><span class="pre">data</span></code> section in the config file.</p>
<p>In this example, assume that you need to rank all math questions and corresponding answers by their difficulties. So you can set these config items like the following example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># basic info</span>
<span class="w">  </span><span class="nt">dataset_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;tests/test_data/test_human_annotator&#39;</span>
<span class="w">  </span><span class="nt">dataset_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">split</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;train&#39;</span><span class="w">  </span><span class="c1"># only need the train split</span>
<span class="w">  </span><span class="nt">format_config</span><span class="p">:</span><span class="w">  </span><span class="c1"># set the field mappings</span>
<span class="w">    </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;prompt&#39;</span>
<span class="w">    </span><span class="nt">chosen_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;chosen&#39;</span>
<span class="w">    </span><span class="nt">rejected_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;rejected&#39;</span>
<span class="w">  </span><span class="c1">#### new part about data active iterator</span>
<span class="w">  </span><span class="nt">dj_config_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;tests/test_configs/human_annotator_test_dj_cfg.yaml&#39;</span>
<span class="w">  </span><span class="c1"># database related. The result dataset will be stored in the database.</span>
<span class="w">  </span><span class="nt">db_url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;postgresql://{user_name}@localhost:5432/{db_name}&#39;</span>
<span class="w">  </span><span class="c1"># downstream loading related</span>
<span class="w">  </span><span class="nt">total_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">  </span><span class="nt">default_workflow_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;math_workflow&#39;</span>
</pre></div>
</div>
<p>Here you can set the basic information for the example dataset, database information that is used to store the result dataset, and some other items about downstream dataset loading for exploring and training, which is similar to the example above.</p>
<p>For this example, we assume that you are somehow familiar with the basic usage of Data-Juicer, so we need to prepare a Data-Juicer data processing recipe in <code class="docutils literal notranslate"><span class="pre">tests/test_configs/human_annotator_test_dj_cfg.yaml</span></code> that includes an OP of <code class="docutils literal notranslate"><span class="pre">human_preference_annotation_mapper</span></code>. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;demo-human-annotator&#39;</span>
<span class="nt">np</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># set np to 1 for human annotation OPs</span>

<span class="nt">export_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;./outputs/demo-human-annotator/annotated-data.jsonl&#39;</span>

<span class="nt">process</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">human_preference_annotation_mapper</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># general annotation project settings</span>
<span class="w">      </span><span class="nt">project_name_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Human_Preference_Annotation_Demo&quot;</span>
<span class="w">      </span><span class="nt">wait_for_annotations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Whether to wait for annotations to complete</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span><span class="w">  </span><span class="c1"># Maximum time to wait for annotations in seconds (1 hour)</span>
<span class="w">      </span><span class="nt">poll_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">  </span><span class="c1"># Time between annotation status checks in seconds</span>
<span class="w">      </span><span class="nt">max_tasks_per_batch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">  </span><span class="c1"># Maximum number of tasks in a single batch</span>
<span class="w">      </span><span class="nt">notification_config</span><span class="p">:</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">      </span><span class="c1"># label studio connection settings</span>
<span class="w">      </span><span class="nt">api_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://localhost:7070&quot;</span><span class="w">  </span><span class="c1"># Default Label Studio URL</span>
<span class="w">      </span><span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05409236-67a5-4169-af96-a52a818d0e81&quot;</span><span class="w">  </span><span class="c1"># Your API key for label studuio authentication # pragma: allowlist secret</span>

<span class="w">      </span><span class="c1"># human preference annotation settings</span>
<span class="w">      </span><span class="nt">prompt_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;prompt&quot;</span><span class="w">  </span><span class="c1"># Prompt field</span>
<span class="w">      </span><span class="nt">answer1_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;answer1&quot;</span><span class="w">  </span><span class="c1"># First answer option</span>
<span class="w">      </span><span class="nt">answer2_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;answer2&quot;</span><span class="w">  </span><span class="c1"># Second answer option</span>
<span class="w">      </span><span class="nt">chosen_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chosen&quot;</span><span class="w">  </span><span class="c1"># Chosen field</span>
<span class="w">      </span><span class="nt">rejected_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rejected&quot;</span><span class="w">  </span><span class="c1"># Rejected field</span>
</pre></div>
</div>
<p>You can set more config items for this OP (e.g. notification when annotation is finished). For more details, please refer to this <a class="reference external" href="https://github.com/modelscope/data-juicer/tree/main/configs/annotation">doc</a>.</p>
</section>
<section id="start-running">
<h3>Start Running<a class="headerlink" href="#start-running" title="Link to this heading"></a></h3>
<p>When you start running with the RFT config, the data module will start the OP <code class="docutils literal notranslate"><span class="pre">human_preference_annotation_mapper</span></code>, and then you can find a new project on the “Projects” page of the label-studio server.</p>
<p><img alt="" src="../_images/data-projects.png" /></p>
<p>You can click and enter into this project, and all the samples that need to be annotated are listed on the page.</p>
<p><img alt="" src="../_images/data-in-projects.png" /></p>
<p>Then you can click any sample and you will enter the labelling page.</p>
<p><img alt="" src="../_images/data-in-labelling-page.png" /></p>
<p>For the preference annotation case, you can choose the preferred/right/chosen one and then click the “Submit” button to submit the annotation result. Then you can select other samples and continue this process.</p>
<p><img alt="" src="../_images/data-labelling.png" /></p>
<p>After all samples are annotated, the OP will end automatically and store the result dataset in the target database specified by the config file. When training begins, it will load the prepared dataset and continue the downstream steps.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example_dpo.html" class="btn btn-neutral float-left" title="Example: Run DPO on Human-Like-DPO-Dataset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="trinity_configs.html" class="btn btn-neutral float-right" title="Trinity-RFT Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Trinity-RFT Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>